?matplot
import numpy as np
?toupper
library(ggplot2)
getvals <- function(dir, pattern, filter){
    files = list.files(path=dir, pattern=paste0('^',pattern), full.names=T, recursive=T)
    files = files[grep(filter, files)]
    say(files)
    table <- as.data.frame(do.call("rbind", lapply(files, FUN=function(file){
      vals=readme(file,skip=95,header=F,gzip=T)
      fold = strsplit(file, "/")[[1]][2]
      foldrun = strsplit(fold, "_")[[1]]
      tmp = cbind(data.frame(fold=foldrun[2], run=foldrun[3]), vals)
      tmp
    })))
    table=aggregate(table[6:ncol(table)], list(table$fold, table$V1, table$V3), mean)
    table
}
a = getvals("spikeinmotif", "codon.*txt", "")
a[,5:54]=a[,5:54]-a[,4]
b=aggregate(a[,5:54], list(a$Group.1,a$Group.3), mean)
codon=aggregate(b[,3:ncol(b)], list(b$Group.2), mean)
codon
apply(codon[,2:ncol(codon)],1,max)
codon$Group.1[apply(codon[,2:ncol(codon)],1,max) > 0.1]
codon$Group.1[apply(codon[,2:ncol(codon)],1,max) > 0.01]
codon$Group.1[apply(codon[,2:12)],1,max) > 0.01]
codon$Group.1[apply(codon[,2:12],1,max) > 0.01]
codon$Group.1[apply(codon[,2:12],1,max) > 0.011]
codon$Group.1[apply(codon[,2:12],1,max) > 0.0105]
codon$Group.1[apply(codon[,2:12],1,max) > 0.0108]
cols = rep("grey",61)
cols[which(codon$Group.1=="GGT")]="red"
cols[which(codon$Group.1=="GGG")]="black"
cols[which(codon$Group.1=="GCT")]="blue"
cols[which(codon$Group.1=="CTC")]="cyan"
cols[which(codon$Group.1=="CTG")]="magenta"
cols[which(codon$Group.1=="GAA")]="green"
cols[which(codon$Group.1=="GAC")]="orange"
cols[which(codon$Group.1=="TGT")]="darkred"
cols[which(codon$Group.1=="CGA")]="brown"
cols[which(codon$Group.1=="CGG")]="lightblue"
matplot(t(as.matrix(codon[,2:ncol(codon)])), type = "l", lty = 1, lwd = 2, col=cols)
abline(v=50)
abline(v=100)
legend("top", codon$Group.1[cols!="grey"], col = cols[cols!="grey"], text.col=cols[cols!="grey"], cex=0.8, lwd=2, ncol=10)
cols = rep("grey",61)
cols[which(codon$Group.1=="GGT")]="red"
cols[which(codon$Group.1=="GGG")]="black"
cols[which(codon$Group.1=="GCT")]="blue"
cols[which(codon$Group.1=="TTC")]="cyan"
cols[which(codon$Group.1=="CTG")]="magenta"
cols[which(codon$Group.1=="GAA")]="green"
cols[which(codon$Group.1=="GAC")]="orange"
cols[which(codon$Group.1=="TGT")]="darkred"
cols[which(codon$Group.1=="CGA")]="brown"
cols[which(codon$Group.1=="CGG")]="lightblue"
matplot(t(as.matrix(codon[,2:ncol(codon)])), type = "l", lty = 1, lwd = 2, col=cols)
abline(v=50)
abline(v=100)
legend("top", codon$Group.1[cols!="grey"], col = cols[cols!="grey"], text.col=cols[cols!="grey"], cex=0.8, lwd=2, ncol=10)
cols = rep("grey",61)
cols[which(codon$Group.1=="GGT")]="brown"
cols[which(codon$Group.1=="GGG")]="black"
cols[which(codon$Group.1=="GCT")]="blue"
cols[which(codon$Group.1=="TTC")]="cyan"
cols[which(codon$Group.1=="CTG")]="magenta"
cols[which(codon$Group.1=="GAA")]="green"
cols[which(codon$Group.1=="GAC")]="orange"
cols[which(codon$Group.1=="TGT")]="darkred"
cols[which(codon$Group.1=="CGA")]="red"
cols[which(codon$Group.1=="CGG")]="lightblue"
matplot(t(as.matrix(codon[,2:ncol(codon)])), type = "l", lty = 1, lwd = 2, col=cols)
abline(v=50)
abline(v=100)
legend("top", codon$Group.1[cols!="grey"], col = cols[cols!="grey"], text.col=cols[cols!="grey"], cex=0.8, lwd=2, ncol=10)
pdf("png/Fig6G.pdf", width=8, height=5)
matplot(t(as.matrix(codon[,2:ncol(codon)])), type = "l", lty = 1, lwd = 2, col=cols)
abline(v=50)
abline(v=100)
legend("top", codon$Group.1[cols!="grey"], col = cols[cols!="grey"], text.col=cols[cols!="grey"], cex=0.8, lwd=2, ncol=10)
dev.off()
pdf("png/Fig6G.pdf", width=9, height=5)
matplot(t(as.matrix(codon[,2:ncol(codon)])), type = "l", lty = 1, lwd = 2, col=cols)
abline(v=50)
abline(v=100)
legend("top", codon$Group.1[cols!="grey"], col = cols[cols!="grey"], text.col=cols[cols!="grey"], cex=0.8, lwd=2, ncol=10)
dev.off()
pdf("png/Fig6G.pdf", width=10, height=5)
matplot(t(as.matrix(codon[,2:ncol(codon)])), type = "l", lty = 1, lwd = 2, col=cols)
abline(v=50)
abline(v=100)
legend("top", codon$Group.1[cols!="grey"], col = cols[cols!="grey"], text.col=cols[cols!="grey"], cex=0.8, lwd=2, ncol=10)
dev.off()
cor(vals$meanVal,vals[,3:ncol(vals)])
cor(vals$meanVal,vals[,3:ncol(vals)], method='spearman')
a=read.delim("codon_stability_coefs_Forrest_et_al.txt")
"codon"
vals = data.frame(codon=codon$Group.1, meanVal = apply(codon[,2:ncol(codon)], 1, mean))
vals = merge(vals,a,by=1)
head(vals)
vals$meanCSC = apply(vals[,3:ncol(vals)], 1, mean)
plot(vals$meanVal, vals$meanCSC, xlab="Saluki mean codon influence", ylab="CSC (Forrest et al)", bty='n', las=1, pch=19)
dev.off()
cor(vals$meanVal,vals[,3:ncol(vals)])
cor(vals$meanVal,vals[,3:ncol(vals)], method='spearman')
library(rhdf5)
file = "ISM/f0_scores.h5"
values = h5read(file,"ism")
values
dim(values)
file = "ISM/f1_scores.h5"
values1 = h5read(file,"ism")
dim(values1)
dim(rbind(values,values1))
dim(cbind(values,values1))
dim(abind(values,values1))
library(abind)
dim(abind(values,values1))
q()
library(rhdf5)
library(ggplot2)
library(abind)
getdata = function(track){
  do.call(abind, lapply(files, function(x){
    h5read(x,track)
  }))
}
preds = getdata("ref")  #(12288, 1294)
files = c("ISM/f0_scores.h5", "ISM/f1_scores.h5", "ISM/f2_scores.h5", "ISM/f3_scores.h5", "ISM/f4_scores.h5", "ISM/f5_scores.h5", "ISM/f6_scores.h5", "ISM/f7_scores.h5", "ISM/f8_scores.h5", "ISM/f9_scores.h5")
preds = getdata("ref")  #(12288, 1294)
dim(preds)
dim(preds[,:])
dim(preds[1,])
dim(preds[1,:])
dim(preds[1,])
len(preds[1,])
length(preds[1,])
R
?save
q()
library(rhdf5)
file = "ISM/f1_scores.h5"
getdata = function(track){
  do.call(abind, lapply(files, function(x){
    h5read(x,track)
  }))
}
files = "ISM/f1_scores.h5"
getdata = function(track){
  do.call(abind, lapply(files, function(x){
    h5read(x,track)
  }))
}
preds = getdata("ref")  #(12288, nseqs)
library(abind)
preds = getdata("ref")  #(12288, nseqs)
dim(preds)
dim(preds[1,1])
dim(preds[1,2])
dim(preds[1])
dim(preds[1,])
preds[1,1]
preds[1,2]
preds[1,]
rep(1,3)
plot(1:5)
